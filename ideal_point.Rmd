---
title: "Ideal Point"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Ideal Points

```{r}
library("tidyverse")
library("pscl")
library("rstan")
```

```{r}
data("s109", package = "pscl")
```

The rollcall votes have the following  [codes](http://voteview.com/senate109.htm).

---- ----------------------------------------------------------
0    not a member
1    Yea
2    Paired Yea
3    Announced Yea,
4    Announced Nay
5    Paired Nay
6    Nay
7    Present (some Congresses, also not used some Congresses)
8    Present (some Congresses, also not used some Congresses)
6    Nay
9    Not Voting
---- ----------------------------------------------------------

To simplify the analysis, the outcomes will be aggregated to "Yes", "No", and missing.


$$
\begin{aligned}[t]
y_{i,j} &\sim \mathsf{BinomialLogit}(\mu_i) \\
\mu_{i,j} &= \alpha_j + \lambda_j \theta_k
$$

Ideal points are unidentified.

Identification of latent state models can be challenging.
Since we \textit{a priori} know, or expect, that the primary ideological dimension is Liberal-Conservative.
$$
\begin{aligned}[t]
\theta_{\mattt{FRIST (R TN)}} & = 1 \\
\theta_{\mattt{REID (D NV)}} & = -1
\begin{aligned}
$$
Otherwise, the 
$$
\begin{aligned}[t]
\theta_{k} &\sim \mathsf{Normal}(0, 2.5)
\end{aligned}
$$
\theta_k &\sim \mathsf{Normal}(0, 2.5) \\
\alpha_j &\sim \mathsf{Normal}(0, 1) \\
\lambda_j &\sim \mathsf{Normal}(0, 1) \\
\end{aligned}
$$


```{r}
votes <- s109$votes %>%
  as.data.frame() %>%
  rownames_to_column("legislator") %>%
  gather(rollcall, vote, -legislator) %>%
  mutate(y = NA,
         y = if_else(vote %in% c(1, 2, 3), TRUE, y),
         y = if_else(vote %in% c(4, 5, 6), FALSE, y),
         legislator = factor(legislator),
         rollcall = factor(rollcall, levels = colnames(s109$votes))) %>%
  filter(!is.na(y))

```

```{r}
mod_ideal_point <- stan_model("stan/ideal_point.stan")
```

```{r}
theta <- data_frame(
  legislator = levels(votes$legislator),
  value = NA_real_
  ) %>%
  mutate(
    value = if_else(legislator == "FRIST (R TN)", -1, value),
    value = if_else(legislator == "REID (D NV)", 1, value)    
  )
```

```{r}
data_ideal_point <-
  within(list(), {
    y <- as.integer(votes$y)
    y_idx_leg <- as.integer(votes$legislator)
    y_idx_vote <- as.integer(votes$rollcall)
    Y_obs <- length(y)
    N <- nlevels(votes$legislator)
    K <- nlevels(votes$rollcall)
    # values of known ideal points
    theta_obs_idx <- which(!is.na(theta$value))
    N_obs <- length(theta_obs_idx)
    theta_param_idx <- which(is.na(theta$value))
    N_param <- length(theta_param_idx)
    theta_obs <- theta$value[theta_obs_idx]
  })
```

```{r}
sampling(mod_ideal_point, data = data_ideal_point)
```

Identification

- @BaiWang2014a "Identification and Bayesian Estimation of Dynamic Factor Models"
- @Quinn2004a

A common identification assumption is an upper triangular matrix on the loadings [@AguilarWest2000a]:
$$
\begin{aligned}[t]
1             & 0             &         \dots  & 0 \\
\lambda_{2,1} & 1             &         \dots  & 0 \\
\vdots        & \vdots        &         \ddots & \vdots \\
\lambda_{k,1} & \lambda_{k,2} &         \dots  & 1 \\
\vdots        & \vdots        &         \vdots & \vdots \\
\lambda_{n,1} & \lambda_{n,2} &          \dots & \lambda_{n,k}
\end{aligned}
$$

See @EroshevaCurtis2017a for a thorough discussion of identification.

Stan Code Examples

- RobertMyles, [Bayesian Ideal Point IRT Models in R using JAGS and Stan](https://github.com/RobertMyles/R-Scripts-Bayesian-Ideal-Point-IRT). Github repo.
- @LuoJiao2017a
- @GrantFurrCarpenterEtAl2015a
- @Curtis2010a
- Kruschke. [Bayesian Item Response Theory in JAGS: A Hierarchical Two Parameter Logistic Model](http://doingbayesiandataanalysis.blogspot.com/2015/12/bayesian-item-response-theory-in-jags.html) Dec 22, 2015.
- Example of [Stan IRT](https://github.com/pablobarbera/quant3materials/blob/master/bayesian/lab14_IRT_issues.R).
- @Gelfand1998a
